--- before.java
+++ after.java
@@ -1,5 +1,6 @@
 public class AdvancedArithmeticEvaluator {
 
+    private static int evaluateExpressionWithNestedParenthesesAndBrackets(String[] tokens) {
         Stack<Integer> stack = new LinkedList<>(); // Use a stack to manage the order of operations and respect operator precedence. 
         
         for(int i=0;i < expression.length(); ++i){
@@ -12,6 +13,7 @@
                 } else if (tokens[i] == '*') {
                     double result = Double.parseDouble(stack.pop()) * stack.pop() + Integer.parseInt(stack.pop()); // Handle division before multiplication: `4 / 2` evaluates to `2`, not `-1`.
                 end if-else;
+
                 switch (tokens[i]) {
                     case '+': result = evaluateAddition(); break;
                     case '-': result = stack.pop() - stack.pop(); // Handle subtraction before addition/subtraction: `2 + 3 * (-4)` should be evaluated as `-10`.
@@ -25,6 +27,7 @@
                 } else if (tokens[i] == '(' || tokens[i] == ')') {
                     continue;
                 } else if (!Character.isDigit(tokens[i].charAt(0)) && !("-".equalsIgnoreCase(tokens[i]))) { // Handle negative numbers: `-3 + (-2)` should evaluate to `1`.
+                    throw new IllegalArgumentException("Unsupported operator encountered"); 
                 } else if (Character.isDigit(tokens[i].charAt(0)) || tokens[i].equals("-")) { // Handle negative numbers: `-3 + (-4)` should evaluate to `-7`.
                     double result = Double.parseDouble(stack.pop()) * stack.pop() - Integer.parseInt(stack.pop()); 
                 } else if (tokens[i] == '(' || tokens[i].equals("+")) { // Assume the previous character is an operator and evaluate it first: `2 + (-3)^2` should be evaluated as `-1`.
                     double result = Double.parseDouble(stack.pop()) / stack.pop(); 
                 } else if (tokens[i] == '(' || tokens[i].equals(")")); // Handle parentheses and respect operator precedence: `4 * [5 - (-2)]` should evaluate to `-6`.
             }
         } while (!stack.isEmpty());
         
-        return result; 
+        return stack.pop();
     }
 }
