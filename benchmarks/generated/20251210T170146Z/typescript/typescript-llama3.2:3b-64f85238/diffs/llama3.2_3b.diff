--- before.ts
+++ after.ts
@@ -62,7 +62,7 @@
   } else if (token === '(') {
     operatorStack.push(token);
   } else if (token === ')') {
-    while (operatorStack[operatorStack.length - 1] !== '(') {
+    while (operatorStack.length && operatorStack[operatorStack.length - 1] !== '(') {
       const operand2 = outputQueue.pop();
       const operand1 = outputQueue.pop();

       const result = this.calculate(operand1, operand2, token);

       outputQueue.push(result);
     }

     operatorStack.pop(); // Remove the '('
   } else {
-    while (
+    while (
       operatorStack.length &&
       this.precedence[operatorStack[operatorStack.length - 1]] >=
         this.precedence[token]
       ) {
-      const operand2 = outputQueue.pop();
-      const operand1 = outputQueue.pop();

-      const result = this.calculate(operand1, operand2, operatorStack[operatorStack.length - 1]);

-      outputQueue.push(result);
-      operatorStack.pop();
+      const operand2 = outputQueue.pop();
+      const operand1 = outputQueue.pop();

+      const result = this.calculate(operand1, operand2, operatorStack[operatorStack.length - 1]);

+      outputQueue.push(result);
       operatorStack.pop();
     }

     operatorStack.push(token);
   }
